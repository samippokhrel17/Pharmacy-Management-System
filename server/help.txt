module.exports = async (req, res) => {
  try {
    let response = {
      status: httpStatus.BAD_REQUEST,
      message: "Data Not found",
    };

    // Extracting request data
    const { medicine_name, dose_strength, unit_price, quantity_available, expiry_date } = req.body;

    // Parse expiry_date into correct format for DATEONLY column
    const parsedExpiryDate = expiry_date ? new Date(expiry_date) : null;

    let insertObj = {
      medicine_name,
      dose_strength,
      unit_price,
      quantity_available,
      expiry_date: parsedExpiryDate, // Use parsedExpiryDate
    };

    let query = await connection.format(
      `
      INSERT IGNORE INTO Pharmacy.medicine
      SET ?
      `,
      [insertObj]
    );

    const [result] = await connection.executeQuery(query);

    if (result && result.warningStatus > 0) {
      return (response = {
        status: httpStatus.BAD_REQUEST,
        message: "Duplicate Data entry!",
      });
    }

    if (result && result.affectedRows > 0) {
      return (response = {
        status: httpStatus.OK,
        message: "Registered successfully!",
      });
    }
  } catch (error) {
    console.error(error);
    return res.status(500).json({ error: "Internal Server Error" });
  }
};
